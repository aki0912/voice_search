# TDDガイド（運用版）

## 基本原則
- 仕様を先にテストで固定する
- 最小実装で通す
- 通った後に必要最小のリファクタを行う

## 現在のテストスイート
- `Tests/VoiceSearchCoreTests`
  - 検索（完全一致/部分一致）
  - 辞書・表記ゆれ（ひらがな/カタカナ）
  - 表示グルーピング
  - TXT整形（改行しきい値含む）
  - パイプライン正規化
- `Tests/VoiceSearchServicesTests`
  - 認可判定
  - サービス選択
  - 音声入力前処理
  - 結果集約
- `Tests/VoiceSearchAppTests`
  - ViewModelの失敗時リセット
  - 検索文脈表示
  - しきい値更新クランプ
  - クリア操作リセット

## 実装時のルール
1. 仕様変更点を先にテストケース化
2. 実装
3. `swift test`
4. 失敗があれば修正して再実行

## 現在の必須ゲート
- コード変更がある場合、`swift test` 成功を完了条件とする
- 失敗状態で「完了」としない

## テスト追加の優先候補
1. `MainView` のUIレイアウト回帰（スナップショット/UITest）
2. 長尺メディア時のスクラブ体感回帰
3. 失敗ログ出力のI/O異常系
4. CLIの診断出力フォーマット固定化
